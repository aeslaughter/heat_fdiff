<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>1-D Snow Finite Difference: Example 1: Layered Snowpack</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<script src="http://www.mathjax.org/mathjax/MathJax.js">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">1-D Snow Finite Difference&#160;<span id="projectnumber">0.1</span></div>
   <div id="projectbrief">C++ implementation of a 1-D finite difference solution of the heat equation applied to snow.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('example1.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Example 1: Layered Snowpack </div>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="ex1_intro"></a>
Introduction</h2>
<p>The following includes a 1-D finite difference solution of the heat equation including short-wave radiation penetration. The following is an example of how to utilize the classes and functions defined in the library. The complete source code file is provided here: <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a>.</p>
<h2><a class="anchor" id="ex1_desc"></a>
Description of Code</h2>
<h3><a class="anchor" id="ex1_preamble"></a>
Preamble</h3>
<p>First the necessary header files are loaded, including the necessary standard libraries. Then the necessary PETsc related headers are included as perscribed in the PETsc documentations for each of the functions used. Finally, the headers associated with this library are included, where <a class="el" href="heat__fdiff_8h.html" title="Header file for heat_fdiff.cpp with code for solving the 1-D heat equatin in parallel.">heat_fdiff.h</a> provides the general functions and the others are used for direct application to snow.</p>
<p><a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> preamble</p>
<h3><a class="anchor" id="ex1_main"></a>
Begin Main Function and User Input</h3>
<p>The main function begins with initizining a time variable for documenting the computation time. Then the command line inputs are handled. By default the temperature data produced is saved in output.dat, but the use may include the desired name from the command line as an additional argument (e.g., ./main data.txt).  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> main</p>
<h3><a class="anchor" id="ex1_var"></a>
Define Objects and Variables</h3>
<p>Four objects are created, the first three, D, E, and C, are basically storage structures for the necessary parameters need to solve the heat equation for snow (see <a class="el" href="_snow_var_8h.html" title="Header file for SnowVar.cpp.">SnowVar.h</a>). The last object, F, is a <a class="el" href="class_flux.html" title="A class for gathering and computing the various flux terms for associated with the snowpack...">Flux</a> object that contains member functions for computing the various flux terms for the snow problem (see <a class="el" href="_flux_8h.html">Flux.h</a>).</p>
<p>Next, all of the variables used throughout the program are defined, including the necessary PETsc vectors and matrix for performing parallel calculations.  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> var</p>
<h3><a class="anchor" id="ex1_build"></a>
Initilize the PETsc Objects</h3>
<p>The PETsc vectors---T, qabs, and bvec---and the stiffness matrix K, must be initilzed. This is accomplished be first initilizing the PETsc package itself, which also initializes MPI.</p>
<p>The temperature vector has special requirements, thus the function from this library, createWithGhosts, was used (see <a class="el" href="heat__fdiff_8h.html" title="Header file for heat_fdiff.cpp with code for solving the 1-D heat equatin in parallel.">heat_fdiff.h</a>). The other vectors and K matrix are created in standard fashion with PETsc functions. The stiffness matrix is diagnol sparse matrix, well suited for the MatCreateMPIAIJ function provided with PETsc.</p>
<p>Finally, the temperature vector is set to the constant starting temperature and assembled using the assebleVec function from this library (see <a class="el" href="heat__fdiff_8h.html" title="Header file for heat_fdiff.cpp with code for solving the 1-D heat equatin in parallel.">heat_fdiff.h</a>).  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> build</p>
<h3><a class="anchor" id="ex_output1"></a>
Initial Output</h3>
<p>Before begining the time loop, the initial temperature vectors is output using the output function from this library (see <a class="el" href="heat__fdiff_8h.html" title="Header file for heat_fdiff.cpp with code for solving the 1-D heat equatin in parallel.">heat_fdiff.h</a>).  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> out1</p>
<h3><a class="anchor" id="ex_loop"></a>
Begin Time Loop</h3>
<p>The temperature for each time step is solved within a loop.  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> loop</p>
<h3><a class="anchor" id="ex_snow"></a>
Compute the Snow Related Terms</h3>
<p>The two flux terms, the surface flux qs, and the absorbed flux, qabs are computed as they pertain to a layered snow pack using the <a class="el" href="class_flux.html" title="A class for gathering and computing the various flux terms for associated with the snowpack...">Flux</a> object (see <a class="el" href="_flux_8h.html">Flux.h</a>) supplied with this library. First the absorbed flux is computed for each layer, in parallel, with the qabsorbed member function of the <a class="el" href="class_flux.html" title="A class for gathering and computing the various flux terms for associated with the snowpack...">Flux</a> object. This vector is then assembled with PETsc's assembly commands. Finally the surface flux is computed with the qsurface member function of the <a class="el" href="class_flux.html" title="A class for gathering and computing the various flux terms for associated with the snowpack...">Flux</a> class.  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> snow</p>
<h3><a class="anchor" id="ex_solve"></a>
Solve for New Temperatures</h3>
<p>Seven steps, in this example are required to solve and record the new temperatures.</p>
<ol type="1">
<li>THe vector and matrix coefficients are computed based on the material properties and the numerical time step and layer thickness.</li>
<li>Based on these coefficients and the flux, the vector of knowns (bvec) is updated.</li>
<li>The absorbed flux vector (qabs) is added to the vector of knowns (bvec).</li>
<li>The stiffness matrix, K, is updated.</li>
<li>The linear system is solved using the solve_temp function of this library (see <a class="el" href="heat__fdiff_8h.html" title="Header file for heat_fdiff.cpp with code for solving the 1-D heat equatin in parallel.">heat_fdiff.h</a>).</li>
<li>The new temperature is outputed to the desired file.</li>
<li>Finally, the temperature array is adjusted not to allow the snow to get above freezing.</li>
</ol>
<p><a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> solve</p>
<h3><a class="anchor" id="ex_finish"></a>
Complete the Program</h3>
<p>After completing all of the desired time steps within the loop the program is completed by finalize the PETsc package and outputing the computation time.  <a class="el" href="example1_8cpp.html" title="An example solution for the 1-D finite difference libraries applied to snow. See Example 1: Layered S...">example1.cpp</a> finish</p>
<h3><a class="anchor" id="ex_results"></a>
Example Results</h3>
<p>Running this example as is produces the output included in example1.dat. Then using the plotT.m MATLAB function the following contour plot is created from this file, which displays the temperature as a function of depth and time is created. </p>
<div class="image">
<img src="example1.png" alt="example1.png"/>
</div>
 </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu Jun 21 2012 20:53:45 for 1-D Snow Finite Difference by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
